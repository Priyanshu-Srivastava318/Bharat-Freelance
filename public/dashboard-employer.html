<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employer Dashboard | Bharat Freelance</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { 
      theme: { 
        extend: { 
          colors: { 
            saffron: "#FF9933",
            brand: "#1dbf73"
          } 
        } 
      } 
    }
  </script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');
    
    * {
      font-family: 'Poppins', sans-serif;
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .job-card {
      transition: all 0.3s ease;
    }
    
    .job-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .stat-card-green {
      background: linear-gradient(135deg, #1dbf73 0%, #059669 100%);
    }
    
    .stat-card-orange {
      background: linear-gradient(135deg, #FF9933 0%, #f97316 100%);
    }
    
    .stat-card-blue {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
    }
  </style>
</head>

<body class="bg-gray-50">

  <!-- üéØ Top Navigation -->
  <nav class="bg-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        
        <!-- Logo -->
        <div class="flex items-center gap-3">
         <a href="index.html" class="text-2xl md:text-3xl font-extrabold cursor-pointer hover:opacity-80 transition">
  <span class="text-saffron">Bharat</span><span class="text-brand">Freelance</span>
</a>
          <span class="text-sm bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-semibold">Employer</span>
        </div>

        <!-- User Info -->
        <div class="flex items-center gap-4">
          <div class="text-right hidden sm:block">
            <p class="text-sm font-semibold text-gray-800" id="userName">Welcome Back!</p>
            <p class="text-xs text-gray-500" id="userEmail"></p>
          </div>
          <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition font-semibold text-sm">
            Logout
          </button>
        </div>

      </div>
    </div>
  </nav>

  <!-- üìä Stats Cards -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 fade-in">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      
      <!-- Total Jobs -->
      <div class="stat-card-green text-white p-6 rounded-2xl shadow-lg">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm opacity-90 mb-1">Total Jobs Posted</p>
            <h3 class="text-4xl font-bold" id="totalJobs">0</h3>
          </div>
          <div class="text-4xl">üíº</div>
        </div>
      </div>

      <!-- Active Jobs -->
      <div class="stat-card-blue text-white p-6 rounded-2xl shadow-lg">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm opacity-90 mb-1">Active Jobs</p>
            <h3 class="text-4xl font-bold" id="activeJobs">0</h3>
          </div>
          <div class="text-4xl">üöÄ</div>
        </div>
      </div>

      <!-- Total Applicants -->
      <div class="stat-card-orange text-white p-6 rounded-2xl shadow-lg">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm opacity-90 mb-1">Total Applicants</p>
            <h3 class="text-4xl font-bold" id="totalApplicants">0</h3>
          </div>
          <div class="text-4xl">üë•</div>
        </div>
      </div>

      <!-- Total Spent -->
      <div class="stat-card text-white p-6 rounded-2xl shadow-lg">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm opacity-90 mb-1">Total Budget</p>
            <h3 class="text-4xl font-bold" id="totalBudget">‚Çπ0</h3>
          </div>
          <div class="text-4xl">üí∞</div>
        </div>
      </div>

    </div>

    <!-- üéØ Header Section -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 fade-in">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">Your Posted Jobs</h2>
          <p class="text-gray-600">Manage all your job postings and view applicants</p>
        </div>
        <button onclick="location.href='postjob.html'" 
          class="bg-gradient-to-r from-saffron to-brand text-white px-8 py-4 rounded-xl hover:shadow-2xl transition font-bold transform hover:scale-105 flex items-center gap-2 whitespace-nowrap">
          <span class="text-xl">‚ûï</span> Post New Job
        </button>
      </div>
    </div>

    <!-- üìã Jobs List -->
    <div id="jobList" class="space-y-6 fade-in"></div>

    <!-- Empty State -->
    <div id="emptyState" class="hidden bg-white rounded-2xl shadow-lg p-12 text-center">
      <div class="text-8xl mb-4">üì≠</div>
      <h3 class="text-2xl font-bold text-gray-800 mb-2">No Jobs Posted Yet</h3>
      <p class="text-gray-600 mb-6">Start by posting your first job and find amazing talent!</p>
      <button onclick="location.href='postjob.html'" 
        class="bg-gradient-to-r from-saffron to-brand text-white px-8 py-4 rounded-xl hover:shadow-2xl transition font-bold inline-flex items-center gap-2">
        <span class="text-xl">‚ûï</span> Post Your First Job
      </button>
    </div>

  </div>

  <script>
  // Load user info
  function loadUserInfo() {
    const user = JSON.parse(localStorage.getItem("user"));
    if(user) {
      document.getElementById("userName").textContent = user.name || "Welcome Back!";
      document.getElementById("userEmail").textContent = user.email || "";
    }
  }

  // Load employer jobs
  async function loadEmployerJobs(){
    const user = JSON.parse(localStorage.getItem("user"));
    
    if(!user || user.role !== 'employer') {
      alert("‚ö†Ô∏è Unauthorized! Only employers can access this.");
      location.href = "login.html";
      return;
    }

    try {
      const res = await fetch(`http://localhost:5000/api/jobs/byEmployer/${user._id}`);
      const jobs = await res.json();
      
      const container = document.getElementById("jobList");
      const emptyState = document.getElementById("emptyState");
      
      container.innerHTML = "";

      if(jobs.length === 0){
        container.classList.add("hidden");
        emptyState.classList.remove("hidden");
        return;
      }

      container.classList.remove("hidden");
      emptyState.classList.add("hidden");

      // Calculate stats
      let totalBudget = 0;
      let activeCount = 0;
      
      jobs.forEach(job => {
        totalBudget += job.budget || 0;
        if(job.status !== 'closed') activeCount++;
      });

      // Update stats
      document.getElementById("totalJobs").textContent = jobs.length;
      document.getElementById("activeJobs").textContent = activeCount;
      document.getElementById("totalBudget").textContent = `‚Çπ${totalBudget.toLocaleString('en-IN')}`;
      // Note: totalApplicants needs actual data from backend

      jobs.forEach((job, index) => {
        const statusColor = job.status === 'closed' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700';
        const statusText = job.status === 'closed' ? 'Closed' : 'Active';
        
        container.innerHTML += `
          <div class="job-card bg-white p-6 rounded-2xl shadow-lg" style="animation-delay: ${index * 0.1}s;">
            
            <!-- Header -->
            <div class="flex justify-between items-start mb-4">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h3 class="text-2xl font-bold text-gray-800">${job.title}</h3>
                  <span class="text-xs ${statusColor} px-3 py-1 rounded-full font-semibold">${statusText}</span>
                </div>
                <p class="text-gray-600 line-clamp-2">${job.description}</p>
              </div>
            </div>

            <!-- Details Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 py-4 border-y border-gray-100">
              
              <div>
                <p class="text-xs text-gray-500 mb-1">Budget</p>
                <p class="font-bold text-brand text-lg">‚Çπ${(job.budget || 0).toLocaleString('en-IN')}</p>
              </div>

              <div>
                <p class="text-xs text-gray-500 mb-1">Category</p>
                <p class="font-semibold text-gray-700">${job.category || 'General'}</p>
              </div>

              <div>
                <p class="text-xs text-gray-500 mb-1">Posted On</p>
                <p class="font-semibold text-gray-700">${new Date(job.createdAt).toLocaleDateString('en-IN')}</p>
              </div>

              <div>
                <p class="text-xs text-gray-500 mb-1">Applicants</p>
                <p class="font-bold text-saffron text-lg">${job.applicants || 0}</p>
              </div>

            </div>

            <!-- Skills -->
            ${job.skills && job.skills.length > 0 ? `
              <div class="mb-4">
                <p class="text-xs text-gray-500 mb-2">Required Skills:</p>
                <div class="flex flex-wrap gap-2">
                  ${job.skills.map(skill => `
                    <span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm font-semibold">${skill}</span>
                  `).join('')}
                </div>
              </div>
            ` : ''}

            <!-- Actions -->
            <div class="flex gap-3">
              <button onclick="viewApplicants('${job._id}')" 
                class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition font-semibold flex items-center justify-center gap-2">
                <span>üë•</span> View Applicants
              </button>
              
              <button onclick="editJob('${job._id}')" 
                class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-xl transition font-semibold">
                ‚úèÔ∏è Edit
              </button>
              
              <button onclick="deleteJob('${job._id}')" 
                class="bg-red-50 hover:bg-red-100 text-red-600 px-6 py-3 rounded-xl transition font-semibold">
                üóëÔ∏è
              </button>
            </div>

          </div>
        `;
      });

    } catch(error) {
      console.error("Error loading jobs:", error);
      alert("‚ùå Error loading jobs. Please try again.");
    }
  }

  function viewApplicants(jobId) {
    location.href = `view-applicants.html?job=${jobId}`;
  }

  function editJob(jobId) {
    // TODO: Navigate to edit page
    alert("Edit functionality coming soon!");
  }

  function deleteJob(jobId) {
    if(confirm("Are you sure you want to delete this job?")) {
      // TODO: Implement delete
      alert("Delete functionality coming soon!");
    }
  }

  function logout() {
    if(confirm("Are you sure you want to logout?")) {
      localStorage.removeItem("token");
      localStorage.removeItem("user");
      location.href = "login.html";
    }
  }

  // Initialize
  loadUserInfo();
  loadEmployerJobs();
  </script>

</body>
</html>